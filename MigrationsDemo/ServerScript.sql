DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'MigrationsDemo.BlogContext'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '202108241528027_InitialCreate'
BEGIN
    CREATE TABLE [dbo].[Blogs] (
        [BlogId] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max),
        CONSTRAINT [PK_dbo.Blogs] PRIMARY KEY ([BlogId])
    )
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'202108241528027_InitialCreate', N'MigrationsDemo.BlogContext',  0x1F8B0800000000000400CD57DB6E1B37107D0FD07F20F8D4028EE8CB4B6AAC1238921D08896C236BE79DDA1DC94479D9925C43FAB63EF493FA0B1DEE5DBB962519015A18102C72E6F0CCE15CA87FFEFA3BFAB456923C8375C2E8313D1B9D52023A31A9D0AB31CDFDF2FD07FAE9E32FEFA2EB54ADC98FDAEE22D8A1A77663FAE47D76C9984B9E4071375222B1C699A51F2546319E1A767E7AFA3B3B3B63801014B10889BEE7DA0B05C517FC3A313A81CCE75CCE4D0AD255EBB81317A8E4962B70194F604CE76265B947166E0ACA50722505471631C825255C6BE38BDDCB4707B1B746AFE20C17B87CD86480764B2E1D54DC2F5BF343C3383D0F61B0D6B1864A72E78D3A12F0ECA2D285F5DDDFA42E6D7443E5AE5161BF095117EA8DE967695694F40FBA9C481B8CFAC28E82F909D95E3C6932001325FC9D90492E7D6E61AC21F796CB13729F2FA448BEC2E6C1FC017AAC7329BBBC9019EE6D2DE0D2BD351958BFF90ECB0EDB594A09DBF6657DE7C6B5E757C634D3FEE29C925B24C117129AEBEFC41F7B63E10B68C03821BDE7DE83C5DB9BA550083860D03B2F7CD6A761BE61D95032E7EB6FA057FE0945E56B4A6EC41AD27AA562F0A80556193A799BC3BE431EADFCC96744ACCD8F61D6603D7A2E50928EA8610DD6FE850CC24AAB92C855476D075362C6E03B688E92964059BDA332415F62D9F0691B032B3B43DD41D88E1612CD7996A1609D9652AD90B8EC2793F7F1F1C5A64A0C96B8176AAE61DB9C8429C657D0DBC5A391E98DB0CE4FB9E70B1EAE6C92AA815957FD1DCAD6277505EED758AB776D1DFE2F3D5EA8FDBE7FABDC0D06A3B03A8AB8A0E1507598815BD1C5B9E47647A54E8CCC957EADEA5F4329EBAF8B51AE1C8E50145717A05818FA47AC177F5F603650B8D7BBFAD7F55AA6F74D9AD39B8CEF65765465D9FE093A48BBD2841214E659A421E5E28DF3A046C16014FF29275260BCADC19C6BB104E7CB164F71909DF706F1FF672832E75279C064FCCF669408CAEE9D42831176F858D2CFDC264FDCFEAAF8FAB72ED291A3E7089CE3C6CBB00FEE1F203BE74799CC639A2EF071F85012AC26CE1B47CBB0B022D67DC046537062D54284E7AC8624646C0B5ADBCCF4D2D41263445D46B549EF06E6E0798AC25C592F963CF1B89D8073C52BE00797399A5CAB05A4337D97FB2CF757CE815AC8AD974BC45E3FBF989FDB9CA3BBAC18083F2304A4293004B8D39F7321D386F7CD30957741841CA9EA0359E12B08E1569B06E9D6E803812AF9A690810ED5F5002A9308E6EE74CC9FE12DDCF001F40D563CD9D4FD7137C8FE8BD8963D9A0A8EA359B90AA3F50F3FCA58F855F6F15FBC66A997C70D0000 , N'6.4.4')
END

IF @CurrentMigration < '202108241610351_AddBlogUrl'
BEGIN
    ALTER TABLE [dbo].[Blogs] ADD [Url] [nvarchar](max)
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'202108241610351_AddBlogUrl', N'MigrationsDemo.BlogContext',  0x1F8B0800000000000400CD57DB6E1B37107D0FD07F20F8D4028EE8CB4B6AAC1238921D08896C236BE79DDA1DC94479D9925C43FAB63EF493FA0B1DEE5DBB962519015A18102C72E6F0CCE15CA87FFEFA3BFAB456923C8375C2E8313D1B9D52023A31A9D0AB31CDFDF2FD07FAE9E32FEFA2EB54ADC98FDAEE22D8A1A77663FAE47D76C9984B9E4071375222B1C699A51F2546319E1A767E7AFA3B3B3B63801014B10889BEE7DA0B05C517FC3A313A81CCE75CCE4D0AD255EBB81317A8E4962B70194F604CE76265B947166E0ACA50722505471631C825255C6BE38BDDCB4707B1B746AFE20C17B87CD86480764B2E1D54DC2F5BF343C3383D0F61B0D6B1864A72E78D3A12F0ECA2D285F5DDDFA42E6D7443E5AE5161BF095117EA8DE967695694F40FBA9C481B8CFAC28E82F909D95E3C6932001325FC9D90492E7D6E61AC21F796CB13729F2FA448BEC2E6C1FC017AAC7329BBBC9019EE6D2DE0D2BD351958BFF90ECB0EDB594A09DBF6657DE7C6B5E757C634D3FEE29C925B24C117129AEBEFC41F7B63E10B68C03821BDE7DE83C5DB9BA550083860D03B2F7CD6A761BE61D95032E7EB6FA057FE0945E56B4A6EC41AD27AA562F0A80556193A799BC3BE431EADFCC96744ACCD8F61D6603D7A2E50928EA8610DD6FE850CC24AAB92C855476D075362C6E03B688E92964059BDA332415F62D9F0691B032B3B43DD41D88E1612CD7996A1609D9652AD90B8EC2793F7F1F1C5A64A0C96B8176AAE61DB9C8429C657D0DBC5A391E98DB0CE4FB9E70B1EAE6C92AA815957FD1DCAD6277505EED758AB776D1DFE2F3D5EA8FDBE7FABDC0D06A3B03A8AB8A0E1507598815BD1C5B9E47647A54E8CCC957EADEA5F4329EBAF8B51AE1C8E50145717A05818FA47AC177F5F603650B8D7BBFAD7F55AA6F74D9AD39B8CEF65765465D9FE093A48BBD2841214E659A421E5E28DF3A046C16014FF29275260BCADC19C6BB104E7CB164F71909DF706F1FF672832E75279C064FCCF669408CAEE9D42831176F858D2CFDC264FDCFEAAF8FAB72ED291A3E7089CE3C6CBB00FEE1F203BE74799CC639A2EF071F85012AC26CE1B47CBB0B022D67DC046537062D54284E7AC8624646C0B5ADBCCF4D2D41263445D46B549EF06E6E0798AC25C592F963CF1B89D8073C52BE00797399A5CAB05A4337D97FB2CF757CE815AC8AD974BC45E3FBF989FDB9CA3BBAC18083F2304A4293004B8D39F7321D386F7CD30957741841CA9EA0359E12B08E1569B06E9D6E803812AF9A690810ED5F5002A9308E6EE74CC9FE12DDCF001F40D563CD9D4FD7137C8FE8BD8963D9A0A8EA359B90AA3F50F3FCA58F855F6F15FBC66A997C70D0000 , N'6.4.4')
END

IF @CurrentMigration < '202108241621475_AddPostClass'
BEGIN
    CREATE TABLE [dbo].[Posts] (
        [PostId] [int] NOT NULL IDENTITY,
        [Title] [nvarchar](200),
        [Content] [nvarchar](max),
        [BlogId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Posts] PRIMARY KEY ([PostId])
    )
    CREATE INDEX [IX_BlogId] ON [dbo].[Posts]([BlogId])
    CREATE UNIQUE INDEX [IX_Title] ON [dbo].[Posts]([Title])
    ALTER TABLE [dbo].[Blogs] ADD [Rating] [int] NOT NULL DEFAULT 3
    ALTER TABLE [dbo].[Posts] ADD CONSTRAINT [FK_dbo.Posts_dbo.Blogs_BlogId] FOREIGN KEY ([BlogId]) REFERENCES [dbo].[Blogs] ([BlogId]) ON DELETE CASCADE
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'202108241621475_AddPostClass', N'MigrationsDemo.BlogContext',  0x1F8B0800000000000400D559DB6EE336107D2FD07F20F4D416592B9797D6B077917592C2E83A0EA264D1B78096C60E518A54452AB051F4CBFAD04FEA2F74A89B254AF22DEB4D8B05820D397338333C339C51FEF9EBEFC18765C8C90BC48A493174CE7AA70E01E1CB8089C5D049F4FCDD8FCE87F7DF7E33B80EC225F95CC85D1839D4146AE83C6B1DF55D57F9CF1052D50B991F4B25E7BAE7CBD0A58174CF4F4F7F72CFCE5C400807B10819DC2742B310D25FF0D791143E443AA17C2203E02A5FC71D2F4525B7340415511F86CE842D62AAD10A7505A174C8256714ADF080CF1D4285903ADDED3F2AF0742CC5C28B7081F28755042837A75C416E7B7F2DBEAB1BA7E7C60D77AD5840F989D232DC13F0EC228F8B6BAB1F145DA78C1B46EE1A23AC57C6EB347A43E723970B87D807F5473C364276607B46FC84D4174F4A062051CCBF13324AB84E62180A48744CF909B94B669CF9BFC0EA41FE06622812CEAB76A165B8575BC0A5BB584610EBD53DCC2BD68E0387B8755DD7562E552DBDCCA7B1D017E70EB94523E88C4379FD15FF3D2D63F81904A09F10DC51AD21C6DB1B079006B06181759EF9599C867CC3B471C8842E3F8158E8670C2A5D3AE4862D212856720B1E05C32C43251D27B0ED90C7981FFD8C7B0C8701DE1C380BE396BEB0451A470BED4E2AAD1C720F3C63CF338BB21CED999DA78C8B37B10CEF25CFC5D3C5A7071A2F40A319D2DEF16412FB960903774DF38DE437307B90DF88BF21F9CDF18790BFD0FB5AE47F609A6F623FD6A62FC04C7C1D34DA73F40CD8AD74EC9A0119C5F74F8082E6CD042852639704B8544AFA2C3DBAC28DECD8BA03D722209D3664012FACC69823E1598414C72387CE0F8D68B4819519BD06CBBCAF839D39765E4CC51570D0402EFDEC451D51E5D3A079071883A0BE82A904B1E130E5C81E85C9C9846EE61D133E8B28EF32D952D8E39D324695F0F6CE1544204C8675C5FD75E796F05690B6C564E05648D32CA6260B5103E28A0169662EDB0A2B765F796D5579F2D94431981EE80A1ABE176B32D798D260595D397F6C1ACA19672DE58A9375843C272BFB8D84B563BD29774A234BFB1A57B5295B2AEA796C6CD2D71D69A909E58DADDB6937EBA78BBEDBED68BC07131A4558642B8D78BE42BCAC0B1FBDF3F66F51C30CC3F5554BA75A5A5B9E846F135D80B56B9E83006E58ACF415D574464D4D1E056143ACCACF0EFA14275529D8BCA3825485B4F97FA6D1D231B7E46EAE7783CE8426E9D337D7BADEA65A3AFB504EE38E476A2479128ACDB5A01B25EB5AAB18D9CAEE08694B5A05481776D72FDACD2A44B1D64419B856141B55AF714F8D27A27EE93B51224BDC575022AD40FB53A25DAD2B9445D7570D657B07B90925EFE5AA20F9D2EE1865A75645291777C7D98FE4472547A398DA22E5E96551B58AE7202F64DB3F6D342A5B26E2100CCF0B0B4C55F3564A43D833023DEF773EE22C0D6D2130A182CD41E96CFCC0FEFBECDCFA42F2DFF95AE12A15F01D3E59BCD9C7036622BB7542DA36206CF85E205E68EC3FD3F8BB902EBFAF22EDF94DE05538F5B93FF579A34BFB8DDC6F36FC1EE5F26AF36E11F5E6C4BBDF0558E3EDAB2EB385C08DD67C8CC3C172E8FC91AAF4C9F8D7A74CEB844C632C217D724AFE3C9003874C9D59D7FD3587C37ADB7DC0947BD074D9D11D1E6DA2FC7F4C91CD667EFB9CD8392666CFE5D00966126F35636FFBF0D43641760E906DB0AD23DD9166CBAACFEB8961DB38D998408F3341369B1BE448E5AF3BC84DC5166B08F3B71E017E8D1DA5CC58CC654152CBA242C42A7813D03440EA5CC69ACDA9AF71DB07A5D217ED33E5098A5C873308C6629AE828D1E83284335EFBB269C8BEE9FC744CAEDB3C98466993FF255C403319BA0053F131613C28EDBE69A9BB1D10268BF267CEDCA536CFDD625522DD4AB123501EBE32F91F208C3882A9A9F0E80B1C62DBA3824FB0A0FEAAE851BB41B65F443DEC832B4671DC0A558EB1D6C75F91C341B87CFF2FAB15BCB0E41C0000 , N'6.4.4')
END

IF @CurrentMigration < '202108250954347_AddPostAbstract'
BEGIN
    ALTER TABLE [dbo].[Posts] ADD [Abstract] [nvarchar](max)
    UPDATE dbo.Posts SET Abstract = LEFT(Content, 100) WHERE Abstract IS NULL
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'202108250954347_AddPostAbstract', N'MigrationsDemo.BlogContext',  0x1F8B0800000000000400D559DB6EE336107D2FD07F20F4D416592B9797D6B077917592C2E83A0EA264D1B78096C60E518A54452AB051F4CBFAD04FEA2F74A89B254AF225899316018C98E41CCE0CCF0C67E87FFEFA7BF0691972F204B162520C9D93DEB14340F83260623174123DFFF0A3F3E9E3B7DF0C2E837049BE16EBCECC3A94146AE83C6A1DF55D57F98F1052D50B991F4B25E7BAE7CBD0A581744F8F8F7F724F4E5C400807B10819DC2642B310D22FF87524850F914E289FC800B8CAC771C64B51C9350D4145D487A133618B986AD4425D40281D72CE19452D3CE073875021A44E67FBF70A3C1D4BB1F0221CA0FC6E1501AE9B53AE20D7BDBF5EBEAB19C7A7C60C772D5840F989D232DC13F0E42CF78B6B8B3FCBBB4EE937F4DC257A58AF8CD5A9F786CE672E170EB137EA8F786C16D98EED99E547A43E785432008962FE8EC828E13A89612820D131E547E4269971E6FF02AB3BF91B88A14838AFEA859AE15C6D00876E621941AC57B730AF683B0E1CE2D6655D5BB814B5E4329BC6429F9D3AE41A95A0330EE5F157ECF7B48CE167108076427043B586184F6F1C40EAC08606D67EE6B3D80DF98661E390095D7E01B1D08FE854BA74C8155B42508CE41ADC0B865186423A4E60DB26F7313FF81EB7E80E03BCD97116C6357D628BD48F16DA8D545A39E41678C69E47166531DA33330F1917AF6219DE4A9E2F4F071FEE68BC008D6A487BC69349EC5B2A0CDC35CD3792DFC0EC417EB3FC1DC96FB67F0EF90BB9B722FF1DD37C13FB3137BD0233F176D0A8CFC12360B7D4B119E37CA69009FE0194ED0CB52C96F68FB4229E9A9156C4E02E9176AE94F459BA758584D9B675032E45403A75C89C55688DFEC2C86211C6126E39747E6878A30DAC4C1D6BB0CCFA3AD8896307E0545C00070DE4DCCFAEEE11553E0D9A67803E08EA2318B3109B60A11C696ACE9E09DD0C70267C1651DEA5B225B0C78568942AE1ED990B88409850EEF2FBCBF62DE12D276DF3C9C0AD90A699B54DB8A304C41505D214B06CCBE058E6E5495CE5816313C5607AA02B687831ADC95C634A836575E1FC566B08679CB5842B46D611F298ACCC3702D6F6F5A6D829952CF56B1CD5A668A988E7BEB1495F37A425279427B6AEDBDDAC702F0A7CB7A3C21F4C68146182AC54FCF908F1B2727FF4C1DBBF160E330CD7572D2571A96DB9135E827401D6ACB97702B862B1D21754D31935297A14848D65557E76D0A7D8A94AC1E61915A42A569BFF338996D2BC257673B92B342634419F5EEED6F136C5D2268B721A77DC8623C993506CCE05DD2859795CC5C8467647486BDF2A403AB0BB7C51D756218AB126CAC0B5BCD8C87A8D736A5C11F543DF891259E0BE80126906DA9F12ED625DAE2CCACBAA2BDB4BD54D2879D15805C98776C7284BC22A4A39B83BCEEB907C5DF45571D6A36F4CB3465AB69794BB97E9D94AC3833C256E7F8D69E4C86C8943D0454F2C30F9D15B290D61CF2CE879BFF31167E921150B2654B039289D754CD8329C9C5A8F3AFF9D071657A980EFF0CAF26EEF1DCC78766B53B7674F537DE2104F34F61F69FC5D4897DF5791F67CC678114EFDA922B579A349FBBD12BC5BBF7E90C3ABB5E885D79B4DFA7E076075E42F3ACC1602378AFC31B619CBA1F3472AD227E35F1F32A923328D3185F4C931F9F3C5ADFA1E56BC66339C35036FD9B3D6BB816734DFCF6A7A3B8AD68335BAFF8FE6B6D9636C6F5F3BBBD7ECEE1D3AC14CE2A966E46DEFE9DA1ADBCEBEB60DB6B5D33C50CB5BB579DDC86CEB721B8DF1611ADB66A5841CA9FCBA85DC546CB18630BF7509F06BEC28D78CC55C1624B5342A9658496C029A06489DF358B33926339CF641A9F47AFC4A79824B2EC3190463314D7494683419C219AFBDEC1AB26FDA3FEDDEEB3A0FA651DA7BBC8609A8264313602A3E278C07A5DE572D1779078489A2FCCE3467A9CDDDB9589548D752EC0894BBAF0CFE3B08238E606A2A3CFA04CFD1ED5EC11758507F5514BCDD20DB0FA2EEF6C105A3D805862AC758CBE357E470102E3FFE0B9F94F43BE41D0000 , N'6.4.4')
END

